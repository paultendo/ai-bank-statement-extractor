# Crédit Agricole Bank Configuration
# French bank - requires Euro currency support

credit_agricole:
  # Bank identification patterns
  identifiers:
    - "CREDIT AGRICOLE"
    - "CRÉDIT AGRICOLE"
    - "Crédit Agricole"
    - "Credit Agricole"
    - "AGRIFRPP"  # BIC code
    - "ca-centreloire.fr"
    - "RELEVE DE COMPTES EN EUROS"

  # Header patterns for metadata extraction
  header_patterns:
    # Account holder name
    account_name: "MADAME\\s+([A-Z]+(?:\\s+[A-Z]+)*)"
    # Account number - e.g., "Compte Chèque n° 72017213831"
    account_number: "Compte [^n]*n[°o]\\s*(\\d+)"
    # IBAN - e.g., "IBAN : FR76 1480 6180 0072 0172 1383 136"
    iban: "IBAN\\s*:\\s*([A-Z0-9\\s]+)"
    # BIC - e.g., "BIC : AGRIFRPP848"
    bic: "BIC\\s*:\\s*([A-Z0-9]+)"
    # Statement date - e.g., "Date d'arrêté : 01 Octobre 2025"
    statement_date: "Date d[''']arrêté\\s*:\\s*(\\d{2}\\s+\\w+\\s+\\d{4})"
    # Statement number - e.g., "RELEVE DE COMPTES EN EUROS N° 010"
    statement_number: "RELEVE DE COMPTES EN EUROS N[°o]\\s*(\\d+)"
    # Balances (with dates embedded in the line)
    # Format: "Ancien solde créditeur au 01.09.2025       1 600,15"
    # Pipeline expects 'previous_balance' and 'new_balance' keys
    previous_balance: "Ancien solde.*?(\\d+[\\s,]*\\d*,\\d{2})\\s*$"
    new_balance: "Nouveau solde.*?(\\d+[\\s,]*\\d*,\\d{2})\\s*$"
    # Period dates from balance lines (used instead of period_start/period_end)
    period_start: "Ancien solde.*?au\\s+(\\d{2}\\.\\d{2}\\.\\d{4})"
    period_end: "Nouveau solde.*?au\\s+(\\d{2}\\.\\d{2}\\.\\d{4})"
    # Total operations
    total_debit: "Total des opérations\\s+([\\d\\s,]+\\.\\d{2})"
    total_credit: "Total des opérations\\s+[\\d\\s,]+\\.\\d{2}\\s+([\\d\\s,]+\\.\\d{2})"

  # Date formats used in Crédit Agricole statements
  date_formats:
    - "%d.%m"         # "02.09" (French format, year inferred from statement period)
    - "%d.%m.%Y"      # "02.09.2025"
    - "%d/%m/%Y"      # "02/09/2025"
    - "%d %B %Y"      # "01 Octobre 2025" (full month name in French)
    - "%d %b %Y"      # "01 Oct 2025" (abbreviated month)

  # Currency
  currency: "EUR"

  # Transaction table structure
  table_structure:
    columns:
      - date_operation    # Date opé.
      - date_value        # Date valeur
      - description       # Libellé des opérations
      - debit            # Débit
      - credit           # Crédit

    # Transaction table header patterns
    header_keywords:
      - "Date"
      - "opé"
      - "valeur"
      - "Libellé"
      - "opérations"
      - "Débit"
      - "Crédit"

  # Transaction type keywords (French descriptions)
  transaction_types:
    card_payment:
      - "Carte"
      - "CB"
      - "Paiement carte"

    direct_debit:
      - "Prlv"
      - "Prélèvement"
      - "Prelevement"

    transfer:
      - "Virement"
      - "VIR"

    atm_withdrawal:
      - "Ret DAB"
      - "Retrait DAB"
      - "Retrait"

    check:
      - "Chèque"
      - "Cheque"
      - "CHQ"

    fee:
      - "Frais"
      - "Cotis"
      - "Cotisation"
      - "Commission"

    interest:
      - "Intérêts"
      - "Interets"

    refund:
      - "Remboursement"
      - "Avoir"
      - "Remb"

    subscription:
      - "Abonnement"
      - "Souscript"

  # Special transaction markers
  special_transactions:
    opening_balance: "Ancien solde"  # Opening balance
    closing_balance: "Nouveau solde"  # Closing balance
    total_operations: "Total des opérations"  # Summary line
    foreign_currency_fee: "Frais carte Ue hors zone Euro"  # FX fee
    foreign_currency_amount: "Mt initial"  # Original FX amount
    continuation: "suite"  # Continuation marker

  # Validation rules specific to Crédit Agricole
  validation:
    # Balance should reconcile within 1 centime
    balance_tolerance: 0.01

    # Date should be in chronological order (or same date)
    enforce_date_order: true

    # Description should not be empty
    require_description: true

  # Field mapping to standardized output
  field_mapping:
    debit: "money_out"      # Débit → money_out
    credit: "money_in"      # Crédit → money_in
    date_operation: "date"  # Date opé. → date
    libelle: "description"  # Libellé → description

  # Notes:
  # - Currency: EUR (€) not GBP (£)
  # - Date format: DD.MM (dot separator, not slash)
  # - Column layout: Date opé. | Date valeur | Libellé | Débit | Crédit
  # - No explicit balance column - balance shown only in summary
  # - French language descriptions
  # - Foreign currency transactions show original amount in description
  # - Some transactions span multiple lines (like Barclays)
