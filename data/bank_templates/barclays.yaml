# Barclays Bank Configuration

barclays:
  identifiers:
    - "Barclays"
    - "Barclays Bank"
    - "BUKBGB22"  # SWIFT/BIC code
    - "barclays.co.uk"

  # Statement header fields
  header_patterns:
    # Account holder name
    account_name: "(?:Barclays Bank Account|Current account statement)[^\\n]*\\n[^\\n]*\\n\\s*([A-Z][a-z]+(?:\\s+[A-Z][a-z]*)*(?:\\s+[A-Z][a-z]+)+)"
    # Account number
    account_number: "Account no\\.?\\s*(\\d{8})"
    # Sort code
    sort_code: "Sort code\\s*(\\d{2}[-\\s]?\\d{2}[-\\s]?\\d{2})"
    # Statement period
    statement_date: "Statement date\\s+(\\d{1,2}\\s+\\w{3}\\s+\\d{4})"
    period_start: "(?i)(\\d{1,2}\\s+\\w{3}\\s+\\d{4})\\s*-\\s*\\d{1,2}\\s+\\w{3}\\s+\\d{4}"
    period_end: "(?i)\\d{1,2}\\s+\\w{3}\\s+\\d{4}\\s*-\\s*(\\d{1,2}\\s+\\w{3}\\s+\\d{4})"
    # Summary balances
    start_balance: "Start balance\\s+£([\\d,]+\\.\\d{2})"
    money_in: "Money in\\s+£([\\d,]+\\.\\d{2})"
    money_out: "Money out\\s+£([\\d,]+\\.\\d{2})"
    end_balance: "End balance\\s+£([\\d,]+\\.\\d{2})"
    iban: "IBAN\\s+([A-Z0-9\\s]+)"
    swift_bic: "SWIFTBIC\\s+([A-Z0-9]+)"

  # Date formats used in Barclays statements
  date_formats:
    - "%d %b"         # "13 Dec" (year inferred from statement period)
    - "%d %b %Y"      # "13 Dec 2023"
    - "%d %B %Y"      # "13 December 2023"

  # Transaction table structure
  table_structure:
    columns:
      - date
      - description
      - money_out
      - money_in
      - balance

    # Column positions (approximate character positions in pdftotext output)
    column_boundaries:
      date_start: 0
      date_end: 12
      description_start: 13
      description_end: 65
      money_out_start: 65
      money_out_end: 85
      money_in_start: 85
      money_in_end: 105
      balance_start: 105
      balance_end: 125

  # Transaction type keywords (for categorization)
  transaction_types:
    direct_debit:
      - "Direct Debit"
      - "DD to"

    card_payment:
      - "Card Payment to"
      - "Contactless"
      - "Debit Card"

    online_transfer:
      - "Online payment to"
      - "Transfer to"

    automated_credit:
      - "Automated Payment"
      - "BACS payment"
      - "Faster Payment"

    standing_order:
      - "Standing Order to"
      - "SO to"

    atm_withdrawal:
      - "Cash machine"
      - "ATM"

    interest:
      - "Interest"
      - "Credit interest"

    fee:
      - "Fee"
      - "Charge"

  # Special transaction markers
  special_transactions:
    start_balance: "Start balance"  # Opening balance
    continued: "Continued"  # Page continuation marker

  # Validation rules specific to Barclays
  validation:
    # Balance should reconcile exactly
    balance_tolerance: 0.01

    # Date should be in chronological order (or same date)
    enforce_date_order: true

    # Description should not be empty
    require_description: true

  # Field mapping to standardized output
  field_mapping:
    money_in: "money_in"
    money_out: "money_out"
    date: "date"
    description: "description"
    balance: "balance"

# Notes for parser implementation:
# 1. Barclays uses multi-line descriptions with continuation on next lines
# 2. Balance only appears on LAST line of multi-line transaction
# 3. "Start balance" shows opening balance with no amounts
# 4. Dates format: "DD MMM" (e.g., "13 Dec") - need to infer year
# 5. Transaction metadata line often follows: "On DD MMM"
# 6. Multiple transactions can share the same date (grouped under one date)
# 7. Column layout: Date | Description | Money out | Money in | Balance
